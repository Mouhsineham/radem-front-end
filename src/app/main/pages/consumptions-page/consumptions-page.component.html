<!--Tooltip Starts-->
<div class="card-header content-header back col-12">
  <div class="row">
    <div class="col-md-6 col-12">
      <h3 class="content-header-title"><i class="fa fa-bookmark" style="color: #2c5599;"></i> {{'MY_CONSUMPTION' |
        translate}}</h3>
    </div>
  </div>
</div>
<div class="content-body">
  <section>
    <div class="mb-0">
      <div class="card-content">
        <div class="card-body">
          <div class="col-12">
            <div class="row">
              <label class="col-form-label">{{'CONTRACT' | translate }} <span
                class="danger">*</span>:</label>
              <div class="col-3">
                <select type="text" class="custom-select" #s
                        (change)="setReportContract(s.value)">
                  <option value="" disabled selected>{{'CHOOSE_A_CONTRACT' | translate}} ...</option>
                  <option *ngFor="let contract of clientContracts" value="{{contract.contractNo}}">
                    {{contract.contractNo}}
                    ({{contract.type}})
                  </option>
                </select>
              </div>
            </div>
          </div>
          <div class="col-12 mt-1">
            <div class="row">
              <div class="col-6 col-sm-6">
                <canvas baseChart #chart1="base-chart" [chartType]="chartType" [datasets]="chartDataSetsVolume"
                        [labels]="chartLabels"
                        [colors]="chartColorsEau"
                        [options]="chartOptionsEau" [legend]="true">
                </canvas>
              </div>
              <div class="col-6 col-sm-6">
                <canvas baseChart #chart2="base-chart" [chartType]="chartType" [datasets]="chartDataSetsInvoice"
                        [labels]="chartLabels"
                        [colors]="chartColorsFact"
                        [options]="chartOptionsFact" [legend]="true">
                </canvas>
              </div>
            </div>
          </div>

          <div class="col-12 mt-3">
            <div class="table-responsive">
              <table class="table">
                <thead class="table-light">
                <tr>
                  <th scope="col">{{'DATE_OF_REPORTS' | translate }}</th>
                  <th scope="col">{{'COUNTER_NUMBER' | translate }}</th>
                  <th scope="col">{{'INDEX' | translate }}</th>
                  <th scope="col">{{'Volume' | translate }}</th>
                  <th scope="col">{{'NOTATION_RELEVANCE' | translate }}</th>
                </tr>
                </thead>
                <tbody>
                <app-data-not-available
                  *ngIf="!consumptionsHistoryCurrentYear || consumptionsHistoryCurrentYear.length == 0; else dataAvailable2"
                  [colSpan]="5"></app-data-not-available>
                <ng-template #dataAvailable2>
                  <tr *ngFor="let consumption of consumptionsHistoryCurrentYear" class="text-center">
                    <td>{{consumption.releveDate}}</td>
                    <td>{{consumption.meterNo}}</td>
                    <td>{{consumption.index}}</td>
                    <td>{{consumption.volume}}</td>
                    <td>{{consumption.annotationReleve}}</td>
                  </tr>
                </ng-template>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="card mb-0">
      <div class="card-header">
        <h4 class="content-header-title">{{'CONSUMPTION_HISTORY' | translate }}</h4>
      </div>
      <div class="card-content">
        <form role="form" [formGroup]="historyForm" novalidate>
          <div class="card-body">
            <div class="row">
              <div class="col-md-2">
                <app-filter (onfilterChanged)="pageFilter($event)"></app-filter>
              </div>
            </div>
            <div class="row col-md-12 form-group">
              <label class="col-form-label">{{'CONTRACT' | translate }} <span
                class="danger">*</span>:</label>
              <div class="col-3">
                <select formControlName="contract" type="text" class="custom-select" #t
                        (change)="setHistoryContract(t.value)">
                  <option value="" disabled selected>{{'CHOOSE_A_CONTRACT' | translate}} ...</option>
                  <option *ngFor="let contract of clientContracts" value="{{contract.contractNo}}">
                    {{contract.contractNo}}
                    ({{contract.type}})
                  </option>
                </select>
              </div>
              <label class="col-form-label">{{'PERIOD_OF' | translate }} <span class="danger"> *</span>
                :</label>
              <div class="col-auto">
                <input [owlDateTime]="sd"
                       [owlDateTimeTrigger]="sd"
                       [min]="minDate"
                       [max]="today"
                       formControlName="startDate"
                       class="form-control date-readonly"
                       id="startDate" readonly>
                <owl-date-time #sd [pickerType]="'calendar'" [startAt]="today"></owl-date-time>
                <div class="text-danger position-absolute mb-1"
                     *ngIf="!historyForm.controls['startDate'].valid && historyForm.controls['startDate'].touched">
                  <div *ngIf="historyForm.controls['startDate'].errors.required">
                    {{'FIELD_REQUIRED' | translate}}
                  </div>
                </div>
              </div>
              <label class="col-form-label">{{'AT' | translate }} <span
                class="danger">*</span></label>
              <div class="col-auto">
                <input [owlDateTime]="ed"
                       [owlDateTimeTrigger]="ed"
                       [min]="minDate"
                       [max]="today"
                       formControlName="endDate"
                       class="form-control date-readonly"
                       id="endDate" readonly>
                <owl-date-time #ed [pickerType]="'calendar'" [startAt]="sd.getValidDate"></owl-date-time>
                <div class="text-danger position-absolute mb-1"
                     *ngIf="!historyForm.controls['endDate'].valid && historyForm.controls['endDate'].touched">
                  <div *ngIf="historyForm.controls['endDate'].errors.required">
                    {{'FIELD_REQUIRED' | translate}}
                  </div>
                </div>
              </div>
              <div class="col-auto float-right row">
                <button type="button" class="btn btn btn-outline-primary"
                        (click)="getConsumptionHistory();" [disabled]="historyForm.invalid">
                  <i class="fa fa-search"></i></button>
                &nbsp;
                <div class="btn-group" dropdown>
                  <button id="button-basic" dropdownToggle type="button"
                          [disabled]="historyForm.invalid"
                          class="btn btn btn-outline-primary dropdown-toggle download"
                          aria-controls="dropdown-basic"><i class="fa fa-download"></i>
                  </button>
                  <div aria-labelledby="dropdownUser"
                       class="dropdown-menu">
                    <a class="dropdown-item" (click)="downloadPdfConsumptions()">
                      <i class="fa fa-file-pdf-o"></i> {{'PDF_FORMAT' | translate }}
                    </a>
                    <a class="dropdown-item" (click)="downloadXlsConsumptions()">
                      <i class="fa fa-file-excel-o"></i> {{'EXCEL_FORMAT' | translate}}
                    </a>
                  </div>
                </div>

              </div>
            </div>
            <div class="table-responsive mx-auto">
              <table class="table">
                <thead class="table-light">
                <tr>
                  <th scope="col">{{'DATE_OF_REPORTS' | translate }}</th>
                  <th scope="col">{{'COUNTER_NUMBER' | translate }}</th>
                  <th scope="col">{{'INDEX' | translate }}</th>
                  <th scope="col">{{'Volume' | translate }}</th>
                  <th scope="col">{{'NOTATION_RELEVANCE' | translate }}</th>
                </tr>
                </thead>
                <tbody>
                <app-data-not-available *ngIf="!consumptionsHistory || consumptionsHistory.length == 0; else dataAvailable"
                                        [colSpan]="5"></app-data-not-available>
                <ng-template #dataAvailable>
                  <tr *ngFor="let consumption of consumptionsHistory" class="text-center">
                    <td>{{consumption.releveDate | date:'dd-MM-yyyy'}}</td>
                    <td>{{consumption.meterNo}}</td>
                    <td>{{consumption.index}}</td>
                    <td>{{consumption.volume}}</td>
                    <td>{{consumption.annotationReleve}}</td>
                  </tr>
                </ng-template>
                </tbody>
              </table>
            </div>
            <app-pagination [showPagination]="totalPages > 1"
                            [numberOfItems]="numberOfItems"
                            [itemsPerPage]="itemsPerPage"
                            [totalItems]="totalElements"
                            [totalPages]="totalPages"
                            (onpageChanged)="pageChanged($event)"></app-pagination>
          </div>
        </form>
      </div>
    </div>
  </section>
</div>
