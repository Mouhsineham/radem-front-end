<!--Tooltip Starts-->
<div class="card-header content-header back col-12">
  <div class="row">
    <div class="col-md-6 col-12">
      <h3 class="content-header-title"><i class="fa fa-bookmark"
                                          style="color: #2c5599;"></i> {{'MY_REGULATIONS' | translate}}</h3>
    </div>
  </div>
</div>
<div class="content-body" id="table">
  <section class="row">
    <div class="col-sm-12">
      <!-- What is-->
      <div id="what-is" class="mb-0">
        <div class="card-content collapse show">
          <form class="" [formGroup]="contractForm">
            <div class="card-body">
              <div class="row form-group col-lg-12 col-md-12 col-sm-12 ">
                <label class="col-form-label">{{'CONTRACT' | translate}}<span class="danger">*</span>:</label>
                <div class="col-auto">
                  <select formControlName="contract" type="text" class="custom-select" #t
                          (change)="setContract(t.value)">
                    <option value="" disabled selected>{{'CHOOSE_A_CONTRACT' | translate}} ...</option>
                    <option *ngFor="let contract of clientContracts" value="{{contract.contractNo}}">
                      {{contract.contractNo}}
                      ({{contract.type}})
                    </option>
                  </select>
                </div>
                <label class="col-form-label">{{'PERIOD_OF' | translate}} <span class="danger">*</span> :</label>
                <div class="col-auto">
                  <input [owlDateTime]="sd"
                         [owlDateTimeTrigger]="sd"
                         [min]="minDate"
                         [max]="today"
                         formControlName="startDate"
                         class="form-control date-readonly"
                         id="startDate" readonly>
                  <owl-date-time #sd [pickerType]="'calendar'" [startAt]="today"></owl-date-time>
                  <div class="text-danger position-absolute mb-1"
                       *ngIf="!contractForm.controls['startDate'].valid && contractForm.controls['startDate'].touched">
                    <div *ngIf="contractForm.controls['startDate'].errors.required">
                      {{'FIELD_REQUIRED' | translate}}
                    </div>
                  </div>
                </div>
                <label class="col-form-label">{{'THE' | translate}} <span class="danger">*</span></label>
                <div class="col-auto">
                  <input [owlDateTime]="ed"
                         [owlDateTimeTrigger]="ed"
                         [min]="minDate"
                         [max]="today"
                         formControlName="endDate"
                         class="form-control date-readonly"
                         id="endDate" readonly>
                  <owl-date-time #ed [pickerType]="'calendar'" [startAt]="ed.getValidDate"></owl-date-time>
                  <div class="text-danger position-absolute mb-1"
                       *ngIf="!contractForm.controls['endDate'].valid && contractForm.controls['endDate'].touched">
                    <div *ngIf="contractForm.controls['endDate'].errors.required">
                      {{'FIELD_REQUIRED' | translate}}
                    </div>
                  </div>
                </div>
                <div class="col-auto float-right row">
                  <button type="button" class="btn btn btn-outline-primary"
                          (click)="getSettlements()" [disabled]="contractForm.invalid">
                    <i class="fa fa-search"></i>
                  </button>
                  &nbsp;
                  <div class="btn-group" dropdown>
                    <button dropdownToggle
                            class="btn btn btn-outline-primary dropdown-toggle download"
                            type="button"><i
                      class="fa fa-download"></i></button>

                    <div aria-labelledby="dropdownUser" class="dropdown-menu">
                      <a class="dropdown-item" (click)="downloadPdfSettlements()">
                        <i class="fa fa-file-pdf-o"></i> {{'PDF_FORMAT' | translate}}
                      </a>
                      <!--<a class="dropdown-item" (click)="downloadXlsSettlements()">
                        <i class="fa fa-file-excel-o"></i> {{'EXCEL_FORMAT' | translate}}
                      </a>-->
                    </div>
                  </div>
                </div>
              </div>
              <div class="table-responsive mx-auto">
                <div class="row justify-content-between">
                  <div class="col-12">
                    <div class="float-left">
                      <app-filter (onfilterChanged)="pageFilter($event)"></app-filter>
                    </div>
                  </div>
                </div>
                <table class="table"
                       sortable-table (sorted)="onSorted($event)"
                       filterable-table (filtred)="onFiltred($event)">
                  <thead class="table-light">
                  <tr>
                    <th scope="col" width="150">{{'BILL_NUMBER' | translate }}</th>
                    <th scope="col">{{'BILLIN_PERIOD' | translate }}</th>
                    <th scope="col">{{'TYPE_OF_NETWORK' | translate }}</th>
                    <th scope="col">{{'SETTLEMENT_DATE' | translate }}</th>
                    <th scope="col">{{'AMOUNT_IN_DH_TTC' | translate }}</th>
                    <th scope="col">{{'SETTLEMENT_MODE' | translate }}</th>
                  </tr>
                  </thead>
                  <tbody>

                  <app-data-not-available
                    *ngIf="!settlements || settlements.length == 0; else dataAvailable"
                    [colSpan]="6"></app-data-not-available>

                  <ng-template #dataAvailable>
                    <tr *ngFor="let settlement of settlements">
                      <td class="text-left">
                      <span class="network-icon"
                            [ngClass]="settlement?.typeNetwork === 'EAU BT' ? 'water' : 'electricity'">
                      <i class="fa fa-2x text-white"
                         [ngClass]="settlement?.typeNetwork === 'EAU BT' ? 'fa-tint' : 'fa-bolt'"></i> &nbsp;
                     </span>&nbsp;
                        <b>{{settlement?.invoiceNo}}</b>
                      </td>
                      <td>{{settlement?.month}} - {{settlement?.year}}</td>
                      <td>{{settlement?.typeNetwork}}</td>
                      <td>{{settlement?.paymentDate | date:'dd-MM-yyyy'}}</td>
                      <td>{{settlement?.amount | numeral}}</td>
                      <td>{{settlement?.paymentMode}}</td>
                    </tr>
                  </ng-template>
                  </tbody>
                </table>
              </div>
              <app-pagination [showPagination]="totalPages > 1"
                              [numberOfItems]="numberOfItems"
                              [itemsPerPage]="itemsPerPage"
                              [totalItems]="totalElements"
                              [totalPages]="totalPages"
                              (onpageChanged)="pageChanged($event)"></app-pagination>
            </div>
          </form>
        </div>
      </div>
      <!--/ What is-->
    </div>
  </section>
</div>
